variables:
  node_version: '12.4.0'

steps:
  - script: |
      set -e
      sudo apt-get update
      sudo apt-get install -y libxkbfile-dev pkg-config libsecret-1-dev libxss1 dbus xvfb libgtk-3-0 libgconf-2-4 libasound2 libxtst6 libnss3
    displayName: 'Install native Linux dependencies'
    condition: in(variables['agent.os'], 'Linux')
  - task: NodeTool@0
    inputs:
      versionSpec: $(node_version)
    displayName: 'Install node.js'
  - script: |
      npm ci
    displayName: 'Install dependencies from npm'
  - script: |
      npm run cover
    displayName: 'Run unit tests'
  - script: |
      npm run test:karma
    displayName: 'Run functional tests'
  - script: |
      npm run check
    displayName: 'Run static analysis checks'

trigger:
  - master

jobs:
  - job: Ubuntu
    pool:
      vmImage: ubuntu-latest
  - job: Windows
    pool:
      vmImage: windows-latest
  - job: macOS
    pool:
      vmImage: macOS-latest
  - job: macOS Catalina
    pool:
      vmImage: 'macOS-10.15'
